# Полное руководство

## Соглашения принятые в документации

`<имя_параметра>` - в угловых скобках обозначаются обязательные аргументы

`[имя_параметра]` - в квадратынх скобках обозначаются не обязательные аргументы

***имя_параметра*** - жирным курсивом выделются имена параметров

:triangular_flag_on_post: - подобным образом обозначается важные моменты, на которые нужно обратить внимание

Все примеры доступны в каталоге `docs/examples`

Для некоторых примеров используется заголовок `example:[название примера]`,
чтобы не было пересечения с правилами из других примеров. 
На него в примерах не нужно фокусировать внимание

Для облегчения чтения, если в примере ответа http-код не указан, то подразумевается код `200`

Для описания запросов к серверу используется синтаксис утилиты `curl`

Все примеры запросов к серверу можно импортировать в `postman` из
[файла#ignore](examples.postman_collection.json)

## Запуск

Для запуска сервера необходимо выполнить следующую команду:

`docker run -p <port>:80 [-e TZ=timezone] [-e AllowMultipleRules=false] -v <rules_path>:/app/rules  mnkvsoft/lira`

либо добавить следующие строки в docker-compose

```
lira:
    container_name: lira
    image: mnkvsoft/lira
    ports:
      - "<port>:80"
    volumes:
       - <rules_path>:/app/rules
```

***port*** - номер порта, который будет слушать сервер

***rules_path*** - каталог в котором будут содержать правила 
и другие файлы (далее **рабочий каталог**), обрабатываемые сервером

***timezone*** - часовой пояс, например `Europe/Moscow`

***AllowMultipleRules=false*** - отключить возможность приоритизации правил.
[Подробнее](matching.md#приоритизация-правил)

## Обработка рабочего каталога

При своей работе **LIRA** постоянно отслеживает рабочий каталог на предмет 
изменений и если они появились, то выполняет загрузку актуальных правил.

Файлы правил должны иметь расширение `.rules`. 

**LIRA** выполняет отслеживание обрабатываемых файлов вне зависимости от их расположения в рабочем каталого 
(т.е. вложенность каталогов не имеет значения).

После добавления или изменений правил для того, чтобы проверить результат загрузки правил 
можно вызвать комманду

`GET http://localhost/sys/state`

которая отобразит текущее состояние сервера со временем последней загрузки. 

Пример результата запроса

`Ok. Load time: 09/23/2023 14:54:46 (146 second ago)`



## Описание продолжительности времени

Продолжительность времени используются для описания различных задержек при обработке правил и 
может быть выполнено различными формами

### Полная форма
```
[d.] hh:mm[:ss[.ff]]
```

***d***  - дни в диапазоне от **0** до **10675199**

***hh*** - часы в диапазоне от **0** до **23**

***mm*** - минуты в диапазоне от **0** до **59**

***ss*** - необязательные секунды в диапазоне от **0** до **59**

***ff*** - необязательная дробная секунда, состоящая из одной до семи десятичных цифр

#### Пример
```
1.00:00:01.123
```

### Короткая форма
При использовании короткой формы записи используется наименование единицы времени и 
ее величина

**Синтаксис**
```
<величина времени> [единица времени]
```
***величина времени*** - целочисленное значение

***единица времени*** - может принимать одно из следующих значений

`ms` | `milliseconds` | `millisecond` - миллисекунды

`s` | `second` | `seconds` - секунды

`m` | `minute` | `minutes` - минуты

`h` | `hour` | `hours` - часы

`d` | `day` | `days` - дни

:triangular_flag_on_post: если значение не указано, то по умолчанию используются 
миллисекунды

#### Пример
```
250 ms
```

## Описание интервалов
Интервалы используются в различных функциях
#### Синтаксис
```
[начало интервала] - [конец интервала]
```
***начало интервала*** - значение начала интервала 
включая само значение

***конец интервала*** - значение конца интервала
включая само значение

#### Примеры использования в функциях
```
int: 1..10
dec: 1.01..10.22
```

Определение интервала может быть взято в квадратные скобки, 
ниже пример с кватратными скобками эквивалентный предыдущему
примеру

```
int: [1..10]
dec: [1.01..10.22]
```



## Симпатичные числа

В некоторых случаях (если указано явно) для числовых значений могут быть 
использованы приемы повышающие читабельность.

- разделение разрядов символом `_`. Пример, число `1000000` может быть записано как `1_000_000`

- использование суффиксов, обозначающих степень 10:

`k` | `K` - кило, 10^3

`m` | `M` - мега, 10^6

`g` | `G` - гига, 10^9

`t` | `T` - тера, 10^12




## Комментарии
При описании правил можно использовать однострочные и многострочные комментарии.

Однострочные комментрации начинаются символами `##`.

Многострочные комментрации начинаются и заканчиваются символами `###`. 
Если завершающие многострочный комментарий символы `###` не определены,
то комментарий распространяется до конца файла

[comments.rules](examples/guide/comments.rules)

Запрос
```
curl --location 'http://localhost/comments' \
--header 'example: guide/comments'
```

Ответ
```
hello!
hello  world!
```




## Что дальше?
[Cопоставление запросов](matching.md)
